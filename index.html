<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>CultureBlend</title>
<link rel="icon" type="image/png" href="favicon.png">

<style>
/* -------------------------------------------------------
   ROOT + GLOBAL
--------------------------------------------------------*/
:root{
  --bg:#060e15;
  --surface:#0d1823;
  --surface-light:#13212d;
  --text:#e9f7f6;
  --text-muted:#9bb0bb;
  --accent:#7ad7b0;
  --accent2:#6fb5ff;

  --radius:12px;
  --radius-sm:8px;

  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  color-scheme: dark;
}
*{box-sizing:border-box;margin:0;padding:0;}

body{
  background:linear-gradient(180deg,#061016,#081621);
  color:var(--text);
  min-height:100vh;
}

/* -------------------------------------------------------
   GENERIC UI
--------------------------------------------------------*/
.card{
  background:var(--surface);
  border-radius:var(--radius);
  padding:16px;
  box-shadow:0 8px 28px rgba(0,0,0,0.45);
}
.btn{
  padding:10px 18px;
  border-radius:var(--radius-sm);
  border:none;
  font-weight:600;
  background:var(--accent);
  color:#042;
  cursor:pointer;
  font-size:15px;
}

.btn.ghost{
  background:rgba(255,255,255,0.08);
  color:var(--text-muted);
}
.btn.white{
  background:white;
  color:#042;
  font-weight:700;
}
.input{
  width:100%;
  padding:10px;
  border-radius:var(--radius-sm);
  border:1px solid rgba(255,255,255,0.08);
  background:rgba(255,255,255,0.05);
  color:var(--text);
}

/* CATEGORY SELECT FIXED VISIBILITY */
.modal select,
.modal option{
  background:#f3f5f7 !important;
  color:#0d1f27 !important;
  border:1px solid rgba(0,0,0,0.12);
}

/* -------------------------------------------------------
   LAYOUT
--------------------------------------------------------*/
.wrapper{
  display:grid;
  grid-template-columns:240px 1fr;
  gap:24px;
  padding:24px;
  max-width:1500px;
  margin:auto;
}

/* SIDEBAR */
.sidebar{
  background:var(--surface);
  border-radius:var(--radius);
  padding:20px;
  height:calc(100vh - 48px);
  position:sticky;
  top:24px;
  display:flex;
  flex-direction:column;
  gap:22px;
}
.side-title{font-weight:700;font-size:18px;}
nav.side-menu button{
  display:flex;
  align-items:center;
  gap:10px;
  background:none;
  border:none;
  padding:10px 12px;
  width:100%;
  text-align:left;
  border-radius:var(--radius-sm);
  color:var(--text-muted);
  cursor:pointer;
  font-size:15px;
}
nav.side-menu button.active{
  background:rgba(255,255,255,0.1);
  color:var(--text);
  font-weight:700;
}
.sidebar-logo{
  width:56px;
  height:56px;
  object-fit:contain;
  border-radius:18px;
}
.quick-actions{
  display:flex;
  flex-direction:column;
  gap:14px; /* increases spacing safely */
}

#resetData:hover{
  background:rgba(255,0,0,0.15);
  color:#ffb3b3;
}
/* -------------------------------------------------------
   TOP NAV
--------------------------------------------------------*/
.topnav{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom:14px;
}

.topnav h2{
  font-size:26px;
  font-weight:700;
}

.topnav-right{
  display:flex;
  gap:14px;
  align-items:center;
}

.profile-mini{
  display:flex;
  align-items:center;
  gap:12px;
  background:var(--surface);
  padding:10px 14px;
  border-radius:var(--radius-sm);
  cursor:pointer;
}
.profile-avatar{
  width:40px;height:40px;
  border-radius:50%;
  background:linear-gradient(135deg,var(--accent),var(--accent2));
  display:flex;align-items:center;justify-content:center;
  font-weight:800;color:#042;
}
.app-logo{
  width:72px;
  height:72px;
  object-fit:contain;
  border-radius:18px;
}
/* -------------------------------------------------------
   ONBOARDING OVERLAY
--------------------------------------------------------*/
#onboardingOverlay{
  position:fixed;
  inset:0;
  background:linear-gradient(145deg,#0077b6,#4c5bff,#9b4dff);
  display:none;
  z-index:2000;
  padding:40px;
  overflow:auto;
}
.onboard-container{
  max-width:700px;
  margin:auto;
  color:white;
}
.onboard-title{
  font-size:32px;
  font-weight:800;
  margin-bottom:6px;
}
.onboard-sub{
  font-size:17px;
  margin-bottom:24px;
  opacity:0.9;
}
.onboard-btn-row{
  display:flex;
  gap:14px;
  margin-bottom:24px;
}
.onboard-btn-row .btn.white{
  flex:1;
  text-align:center;
}
.onboard-feature{
  background:rgba(255,255,255,0.18);
  border-radius:14px;
  padding:14px 18px;
  margin-bottom:16px;
}
.onboard-feature-title{
  font-weight:700;
  margin-bottom:4px;
  display:flex;
  align-items:center;
  gap:10px;
}
.onboard-close{
  text-align:center;
  margin-top:20px;
}
.onboard-close a{
  color:white;
  text-decoration:underline;
  opacity:0.9;
  cursor:pointer;
}

/* -------------------------------------------------------
   FEED CARDS (NO IMAGE VERSION)
--------------------------------------------------------*/
.feed-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(320px,1fr));
  gap:20px;
}
.post-card{
  background:var(--surface-light);
  border-radius:var(--radius);
  padding:18px;
  display:flex;
  flex-direction:column;
  gap:10px;
}
.post-title{font-size:17px;font-weight:700;}
.post-meta{font-size:13px;color:var(--text-muted);}
.post-excerpt{font-size:14px;color:var(--text-muted);}

/* RATING */
.star{cursor:pointer;font-size:18px;color:#777;}
.star.on{color:#ffd66b;}

.empty{
  padding:40px;
  text-align:center;
  color:var(--text-muted);
}

.country-item{
  display:flex;align-items:center;gap:8px;
  cursor:pointer;
}

/* MODAL */
.modal-back{
  position:fixed;inset:0;
  background:rgba(0,0,0,0.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:1000;
}
.modal{
  background:var(--surface-light);
  border-radius:var(--radius);
  padding:20px;
  max-width:700px;
  width:100%;
}

.post-card{
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.post-card:hover{
  transform: translateY(-4px);
  box-shadow: 0 12px 32px rgba(0,0,0,0.6);
}

/* MOBILE */
@media(max-width:900px){
  .wrapper{grid-template-columns:1fr;}
  .sidebar{position:static;height:auto;}
  .topnav{flex-direction:column;align-items:flex-start;}
}
</style>
</head>

<body>

<!-- ---------------- ONBOARDING ---------------- -->
<div id="onboardingOverlay">
  <div class="onboard-container">
    <div class="onboard-title">Welcome to CultureBlend üëã</div>
    <div class="onboard-sub">Share your culture, explore others, and connect with people around the world.</div>

    <div class="onboard-btn-row">
      <button class="btn white" id="onboardCreate">Create a Post</button>
      <button class="btn white" id="onboardCountries">Explore Countries</button>
    </div>

    <div class="onboard-feature">
      <div class="onboard-feature-title">üìú Share Your Culture</div>
      Post stories, recipes, memories, rituals, or questions.
    </div>

    <div class="onboard-feature">
      <div class="onboard-feature-title">üåç Explore Countries</div>
      Browse culture by region, tradition, and topic.
    </div>

    <div class="onboard-feature">
      <div class="onboard-feature-title">üë• Find People</div>
      Discover others with shared cultural connections.
    </div>

    <div class="onboard-close"><a id="onboardDismiss">Got it ‚Äî Continue</a></div>
  </div>
</div>


<div class="wrapper">

  <!-- SIDEBAR -->
  <aside class="sidebar">

  <!-- Logo -->
     <div style="display:flex;align-items:center;gap:12px;margin-bottom:10px;">
       <img src="logo.jpeg" alt="CultureBlend logo" class="sidebar-logo">
       <div class="side-title">CultureBlend</div>
     </div>

    <nav class="side-menu" id="sideMenu">
      <button class="active" data-view="feed">üè† Public Feed</button>
      <button data-view="myblog">üìù My Blog</button>
      <button data-view="countries">üåç Country Hub</button>
      <button data-view="people">üë• Find People</button>
    </nav>

    <div class="quick-actions">
     <div class="side-title">Quick Actions</div>

     <button class="btn ghost" id="gotoFeed">Go to Feed</button>
     <button class="btn ghost" id="gotoProfile">Edit Profile</button>
   </div>


     <!-- Danger zone -->
   <div style="margin-top:auto;">
     <button class="btn ghost"
          id="resetData"
          style="width:100%;opacity:0.7;">
    Reset
     </button>
   </div>
  </aside>

  <!-- MAIN -->
  <main>

    <div class="topnav">
        <h2>Discover stories</h2>


      <div class="topnav-right">
        <button class="btn" id="newPostBtn">+ New Post</button>

        <div class="profile-mini" id="profileMini">
          <div class="profile-avatar" id="navAvatar">F</div>
          <span id="navName">Freya</span>
        </div>
      </div>
    </div>

    <div id="mainCard" class="card">

      <!-- FEED VIEW -->
      <div id="feedView">
        <input id="feedSearch" class="input" placeholder="Search posts...">
        <div id="feed" class="feed-grid" style="margin-top:14px;"></div>
      </div>

      <!-- MY BLOG VIEW -->
      <div id="myBlogView" style="display:none;">
        <h3>My Blog</h3>
        <div id="myBlogFeed" class="feed-grid" style="margin-top:14px;"></div>
      </div>

      <!-- COUNTRY HUB -->
      <div id="countriesView" style="display:none;">
        <h3>Country Hub</h3>
        <div id="countryHubArea" style="margin-top:14px;"></div>
      </div>

      <!-- PEOPLE VIEW -->
      <div id="peopleView" style="display:none;">
        <h3>Find People</h3>
        <div style="display:flex;gap:10px;margin:14px 0;">
          <input id="personCountryTab" class="input" placeholder="Country">
          <input id="personInterestTab" class="input" placeholder="Interest">
          <button class="btn" id="findPeopleBtnTab">Find</button>
        </div>
        <div id="exploreResults" style="display:flex;flex-direction:column;gap:14px;"></div>
      </div>

    </div>
  </main>
</div>


<!-- MODAL -->
<div class="modal-back" id="modalBack">
  <div class="modal" id="modal"></div>
</div>


<script>
/* -----------------------------------------------------
   STORAGE + INITIAL DATA
------------------------------------------------------*/
const LS_KEY = "cultureblend_final_v5";

const DEFAULT_USER = {
  name:"Freya Lindholm",
  country:"Sweden",
  languages:"Swedish, English",
  interests:"music, recipes"
};

/* SAMPLE POSTS */
const SAMPLE_POSTS = [
  { id:"p1", title:"Grandma‚Äôs Cinnamon Buns", authorName:"Freya Lindholm",
    country:"Sweden", category:"Recipe",
    text:"A family tradition every Sunday.",
    createdAt:"2025-12-01", visibility:"public",
    ratings:{}, comments:[] },

  { id:"p2", title:"Diwali at Home", authorName:"Arjun Patel",
    country:"India", category:"Ritual",
    text:"Lighting diyas and sweets.",
    createdAt:"2025-12-02", visibility:"public",
    ratings:{}, comments:[] },

  { id:"p3", title:"Guanxi ‚Äî Chinese Concept", authorName:"Mei Huang",
    country:"China", category:"Word",
    text:"Understanding social relationships.",
    createdAt:"2025-12-03", visibility:"public",
    ratings:{}, comments:[] },

  { id:"p4", title:"Mariachi Memories", authorName:"Sofia Ramirez",
    country:"Mexico", category:"Song",
    text:"My grandfather played violin.",
    createdAt:"2025-12-04", visibility:"public",
    ratings:{}, comments:[] },

  { id:"p5", title:"Nile-side Evenings", authorName:"Omar El-Sayed",
    country:"Egypt", category:"Story",
    text:"Tea by the Nile at sunset.",
    createdAt:"2025-12-05", visibility:"public",
    ratings:{}, comments:[] },

  { id:"p6", title:"Obon Festival", authorName:"Hana Yoshida",
    country:"Japan", category:"Ritual",
    text:"Lanterns and dances honoring ancestors.",
    createdAt:"2025-12-06", visibility:"public",
    ratings:{}, comments:[] },

  { id:"p7", title:"Jollof Rice Debate", authorName:"Chinedu Okeke",
    country:"Nigeria", category:"Recipe",
    text:"Nigerian Jollof is the best!",
    createdAt:"2025-12-07", visibility:"public",
    ratings:{}, comments:[] }
];

const INITIAL = {
  user:DEFAULT_USER,
  posts:SAMPLE_POSTS,
  seenOnboarding:false
};

function load(){
  const raw = localStorage.getItem(LS_KEY);
  if(!raw){
    localStorage.setItem(LS_KEY, JSON.stringify(INITIAL));
    return JSON.parse(JSON.stringify(INITIAL));
  }
  try{ return JSON.parse(raw); }
  catch{
    localStorage.removeItem(LS_KEY);
    localStorage.setItem(LS_KEY, JSON.stringify(INITIAL));
    return JSON.parse(JSON.stringify(INITIAL));
  }
}

function save(data){ localStorage.setItem(LS_KEY, JSON.stringify(data)); }

let state = load();


/* UTIL */
const esc = s => String(s).replace(/</g,"&lt;");
const short = (t,n) => t.length>n ? t.slice(0,n-1)+"‚Ä¶" : t;


/* -----------------------------------------------------
   ONBOARDING
------------------------------------------------------*/
function showOnboarding(){ onboardingOverlay.style.display="block"; }
function hideOnboarding(){
  onboardingOverlay.style.display="none";
  state.seenOnboarding = true;
  save(state);
}
if(!state.seenOnboarding) setTimeout(showOnboarding,200);

onboardDismiss.onclick = hideOnboarding;
onboardCreate.onclick = () => { hideOnboarding(); openNewPost(); };
onboardCountries.onclick = () => {
  hideOnboarding();
  sideMenu.querySelector('[data-view="countries"]').click();
};


/* -----------------------------------------------------
   NAV PROFILE MINI
------------------------------------------------------*/
function renderNavProfile(){
  const u = state.user;
  navAvatar.textContent = u.name.split(" ").map(x=>x[0]).join("");
  navName.textContent = u.name.split(" ")[0];
}


/* -----------------------------------------------------
   FEED RENDER
------------------------------------------------------*/
function renderFeed(){
  const q = feedSearch.value.toLowerCase();
  const posts = state.posts.filter(p =>
    p.visibility==="public" &&
    (p.title + p.text + p.country + p.authorName).toLowerCase().includes(q)
  ).sort((a,b)=>b.createdAt.localeCompare(a.createdAt));

  if(posts.length===0){
    feed.innerHTML = `<div class="empty">No posts found.</div>`;
    return;
  }

  feed.innerHTML = posts.map(postCardHTML).join("");
}

function postCardHTML(p){
  const avg = computeRatingAvg(p);

  return `
    <div class="post-card">
      <div class="post-title">${esc(p.title)}</div>
      <div class="post-meta">${esc(p.authorName)} ¬∑ ${esc(p.country)}</div>
      <div class="post-excerpt">${esc(short(p.text,180))}</div>

      <div style="margin-top:4px;">
        <div class="rating" data-id="${p.id}">
          ${renderStars(avg, p.id)}
          <span class="post-meta">${Object.keys(p.ratings).length} ratings</span>
        </div>
      </div>

      <button class="btn ghost" onclick="openPost('${p.id}')">Open</button>
    </div>
  `;
}


/* STARS */
function computeRatingAvg(p){
  const values = Object.values(p.ratings);
  if(values.length===0) return 0;
  const avg = values.reduce((a,b)=>a+b,0)/values.length;
  return Math.round(avg*10)/10;
}

function renderStars(avg, postId){
  let html = "";
  for(let i=1;i<=5;i++){
    html += `<span class="star ${i<=Math.round(avg)?"on":""}"
                   data-star="${i}" data-post="${postId}"
                   onclick="ratePost('${postId}',${i})">‚òÖ</span>`;
  }
  return html;
}

function ratePost(postId, star){
  const user = state.user.name;
  const p = state.posts.find(x => x.id === postId);

  p.ratings[user] = star;  // ONE rating per user

  save(state);
  renderAll();
}


/* -----------------------------------------------------
   MY BLOG
------------------------------------------------------*/
function renderMyBlog(){
  const me = state.user.name;
  const posts = state.posts.filter(p => p.authorName===me)
                           .sort((a,b)=>b.createdAt.localeCompare(a.createdAt));

  if(posts.length===0){
    myBlogFeed.innerHTML = `<div class="empty">You haven't posted anything yet.</div>`;
    return;
  }

  myBlogFeed.innerHTML = posts.map(postCardHTML).join("");
}


/* -----------------------------------------------------
   COUNTRIES
------------------------------------------------------*/
function uniqueCountries(){
  return [...new Set(state.posts.map(p=>p.country))].sort();
}

function renderCountries(){
  const list = uniqueCountries();

  countryHubArea.innerHTML = list.map(c => {
    const count = state.posts.filter(p=>p.country===c).length;
    return `
      <div class="card" style="margin-bottom:10px;">
        <strong>${esc(c)}</strong>
        <div class="post-meta">${count} posts</div>
        <button class="btn ghost" onclick="openCountry('${c}')">Open Hub</button>
      </div>`;
  }).join("");
}

function openCountry(country){
  const posts = state.posts.filter(p=>p.country===country);

  showModal(`
    <div style="display:flex;justify-content:space-between;">
      <h3>${esc(country)}</h3>
      <button class="btn ghost" onclick="closeModal()">Close</button>
    </div>

    ${
      posts.length
      ? posts.map(p=>`
          <div class="card" style="margin-top:12px;">
            <strong>${esc(p.title)}</strong>
            <div class="post-meta">${esc(p.authorName)} ¬∑ ${esc(p.category)}</div>
            <p>${esc(short(p.text,180))}</p>
            <button class="btn ghost" onclick="openPost('${p.id}')">Open</button>
          </div>
        `).join("")
      : `<div class="empty">No posts for ${esc(country)}.</div>`
    }
  `);
}


/* -----------------------------------------------------
   PEOPLE
------------------------------------------------------*/
function findPeople(country, interest){
  const authors = [...new Set(state.posts.map(p=>p.authorName))];

  const people = authors.map(name=>{
    const posts = state.posts.filter(p=>p.authorName===name);
    return {
      name,
      countries:[...new Set(posts.map(p=>p.country))].join(", "),
      interests:[...new Set(posts.map(p=>p.category.toLowerCase()))].join(", ")
    };
  });

  return people.filter(p =>
    (!country || p.countries.toLowerCase().includes(country.toLowerCase())) &&
    (!interest || p.interests.toLowerCase().includes(interest.toLowerCase()))
  );
}

function renderPeople(list){
  if(list.length === 0){
    exploreResults.innerHTML = `<div class="empty">No people found.</div>`;
    return;
  }

  exploreResults.innerHTML = list.map(p => `
    <div class="card">
      <strong>${esc(p.name)}</strong>
      <button class="btn ghost" style="margin-top:8px;" onclick="openPerson('${p.name}')">Open</button>
    </div>
  `).join("");
}



/* -----------------------------------------------------
   PERSON MODAL
------------------------------------------------------*/
function openPerson(name){
  const posts = state.posts.filter(p => p.authorName === name);
  const countries = [...new Set(posts.map(p => p.country))].join(", ");
  const categories = [...new Set(posts.map(p => p.category))].join(", ");

  showModal(`
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <div>
        <strong style="font-size:18px;">${esc(name)}</strong>
        <div class="post-meta">${esc(countries)} ¬∑ ${esc(categories)}</div>
      </div>
      <button class="btn ghost" onclick="closeModal()">Close</button>
    </div>

    <h4 style="margin-top:14px;">Posts</h4>
    <div style="margin-top:10px;">
      ${
        posts.length
        ? posts.map(p => `
            <div class="card" style="margin-top:10px;">
              <strong>${esc(p.title)}</strong>
              <div class="post-meta">${esc(p.country)} ¬∑ ${esc(p.category)}</div>
              <p style="margin-top:6px;">${esc(short(p.text,160))}</p>
              <button class="btn ghost" style="margin-top:6px;" onclick="openPost('${p.id}')">Open</button>
            </div>
          `).join("")
        : `<div class="empty">No posts yet.</div>`
      }
    </div>
  `);
}




/* -----------------------------------------------------
   POST VIEW MODAL (COMMENTS + UPVOTES)
------------------------------------------------------*/
function openPost(id){
  const p = state.posts.find(x=>x.id===id);

  showModal(`
    <div style="display:flex;justify-content:space-between;">
      <h3 style="font-size:22px;font-weight:800;margin-bottom:6px;">
        ${esc(p.title)}
      </h3>

      <button class="btn ghost" onclick="closeModal()">Close</button>
    </div>

    <div class="post-meta" style="margin-bottom:14px;">
     ${esc(p.authorName)} ¬∑ ${esc(p.country)}
    </div>

    <div style="
  background:rgba(255,255,255,0.05);
  padding:14px;
  border-radius:10px;
  margin-top:12px;
  font-size:15px;
  line-height:1.6;
">
  ${esc(p.text)}
</div>


    <h4 style="margin-top:20px;">Rating</h4>
    <div class="rating">${renderStars(computeRatingAvg(p), p.id)}</div>

    <h4 style="margin-top:24px;">Comments</h4>
    <div id="commentList">
      ${
        p.comments.map(c=>`
          <div style="
  background:rgba(255,255,255,0.04);
  padding:14px;
  border-radius:12px;
  margin-top:12px;
">
            <strong style="font-size:15px;">${esc(c.author)}</strong>
            <div class="post-meta">${c.createdAt}</div>
            <p style="margin-top:6px;">${esc(c.text)}</p>
            <button class="btn ghost"
        style="margin-top:8px;font-size:14px;"
        onclick="upvoteComment('${p.id}','${c.id}')">
  ‚ñ≤ ${c.upvotes}
</button>

          </div>
        `).join("")
      }
    </div>

    <form id="commentForm" style="margin-top:18px;display:flex;flex-direction:column;gap:12px;">
      <input id="commentAuthor" class="input" placeholder="Your name" value="${esc(state.user.name)}">
      <textarea id="commentText" class="input" placeholder="Write a comment..."></textarea>
      <button class="btn" style="margin-top:8px;">
  Add Comment
</button>

    </form>
  `);

  commentForm.onsubmit = e=>{
    e.preventDefault();
    const txt = commentText.value.trim();
    if(!txt) return alert("Write something");

    p.comments.push({
      id:"c"+Math.random().toString(36).slice(2),
      author:commentAuthor.value,
      text:txt,
      createdAt:new Date().toISOString().slice(0,10),
      upvotes:0
    });

    save(state);
    openPost(id);
  };
}

function upvoteComment(postId, commentId){
  const p = state.posts.find(x=>x.id===postId);
  const c = p.comments.find(x=>x.id===commentId);
  c.upvotes++;
  save(state);
  openPost(postId);
}


/* -----------------------------------------------------
   NEW POST MODAL
------------------------------------------------------*/
function openNewPost(prefillCountry=""){
  showModal(`
    <div style="display:flex;justify-content:space-between;">
      <h3>New Post</h3>
      <button class="btn ghost" onclick="closeModal()">Close</button>
    </div>

    <form id="newPostForm" style="margin-top:16px;display:flex;flex-direction:column;gap:12px;">

      <input id="postTitle" class="input" placeholder="Title (required)" required>

      <input id="postCountry" class="input" placeholder="Country"
             value="${prefillCountry || state.user.country}">

      <select id="postCategory" class="input" required>
        <option value="">Select category (required)</option>
        <option>Story</option>
        <option>Recipe</option>
        <option>Ritual</option>
        <option>Word</option>
        <option>Song</option>
        <option>Question</option>
        <option>Other</option>
      </select>

      <textarea id="postText" class="input" placeholder="Write your post..."></textarea>

      <label><input type="checkbox" id="postPublic" checked> Make public</label>

      <button class="btn">Publish</button>
    </form>
  `);

  newPostForm.onsubmit = e=>{
    e.preventDefault();

    const p = {
      id:"p"+Math.random().toString(36).slice(2),
      title:postTitle.value.trim(),
      authorName:state.user.name,
      country:postCountry.value.trim(),
      category:postCategory.value,
      text:postText.value.trim(),
      createdAt:new Date().toISOString().slice(0,10),
      visibility:postPublic.checked ? "public" : "private",
      ratings:{},
      comments:[]
    };

    state.posts.push(p);
    save(state);
    closeModal();
    renderAll();
  };
}


/* -----------------------------------------------------
   PROFILE
------------------------------------------------------*/
function openProfileModal(){
  const u = state.user;

  showModal(`
    <div style="display:flex;justify-content:space-between;">
      <h3>Edit Profile</h3>
      <button class="btn ghost" onclick="closeModal()">Close</button>
    </div>

    <form id="profileForm" style="margin-top:16px;display:flex;flex-direction:column;gap:12px;">
      <input id="pfName" class="input" value="${esc(u.name)}">
      <input id="pfCountry" class="input" value="${esc(u.country)}">
      <input id="pfLanguages" class="input" value="${esc(u.languages)}">
      <input id="pfInterests" class="input" value="${esc(u.interests)}">
      <button class="btn">Save</button>
    </form>
  `);

  profileForm.onsubmit = e=>{
    e.preventDefault();

    u.name = pfName.value.trim();
    u.country = pfCountry.value.trim();
    u.languages = pfLanguages.value.trim();
    u.interests = pfInterests.value.trim();

    save(state);
    renderAll();
    closeModal();
  };
}


/* -----------------------------------------------------
   MODAL HELPERS
------------------------------------------------------*/
function showModal(html){
  modal.innerHTML = html;
  modalBack.style.display="flex";
}
function closeModal(){
  modalBack.style.display="none";
  modal.innerHTML="";
}


/* -----------------------------------------------------
   BINDINGS
------------------------------------------------------*/
newPostBtn.onclick = ()=>openNewPost();
gotoProfile.onclick = ()=>openProfileModal();
gotoFeed.onclick = ()=>sideMenu.querySelector('[data-view="feed"]').click();
feedSearch.oninput = ()=>renderFeed();

findPeopleBtnTab.onclick = ()=>{
  renderPeople(findPeople(personCountryTab.value, personInterestTab.value));
};

sideMenu.onclick = e=>{
  if(e.target.tagName!=="BUTTON") return;

  sideMenu.querySelectorAll("button").forEach(b=>b.classList.remove("active"));
  e.target.classList.add("active");

  const view = e.target.dataset.view;

  feedView.style.display = view==="feed" ? "" : "none";
  myBlogView.style.display = view==="myblog" ? "" : "none";
  countriesView.style.display = view==="countries" ? "" : "none";
  peopleView.style.display = view==="people" ? "" : "none";

  if(view==="myblog") renderMyBlog();
};

resetData.onclick = ()=>{
  if(confirm("Reset all data?")){
    localStorage.removeItem(LS_KEY);
    state = load();
    renderAll();
    showOnboarding();
  }
};


/* -----------------------------------------------------
   INITIAL RENDER
------------------------------------------------------*/
function renderAll(){
  renderNavProfile();
  renderFeed();
  renderCountries();
}

renderAll();

</script>

<footer style="
  text-align:center;
  color:var(--text-muted);
  font-size:13px;
  margin:24px 0 10px;
">
  Designed by <strong>MiHermes</strong>
</footer>

</body>
</html>
